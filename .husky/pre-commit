#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check if pnpm-lock.yaml is up to date
echo "ğŸ“¦ Checking lockfile sync..."
if ! pnpm install --frozen-lockfile > /dev/null 2>&1; then
  echo "âŒ pnpm-lock.yaml is out of sync with package.json files"
  echo "ğŸ’¡ Run 'pnpm install' to update the lockfile"
  exit 1
fi
echo "âœ… Lockfile is up to date"

# Run lint-staged for staged files
echo "ğŸ§¹ Running lint-staged..."
npx lint-staged

# Run typecheck to catch type errors before committing
echo "ğŸ” Running typecheck..."
if ! pnpm run typecheck; then
  echo "âŒ Typecheck failed. Fix type errors before committing."
  exit 1
fi
echo "âœ… Typecheck passed"