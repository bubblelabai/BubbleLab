# Storage Bubble

Cloudflare R2 storage operations for file management

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Quick Start

```typescript
import { StorageBubble } from '@bubblelab/bubble-core';
import { CredentialType } from '@bubblelab/shared-schemas';
const result = await new StorageBubble({
  operation: 'getUploadUrl',
  bucketName: 'user-uploads',
  fileName: 'avatar.png',
  accountId: process.env.CLOUDFLARE_R2_ACCOUNT_ID as string,
  contentType: 'image/png',
  credentials: {
    [CredentialType.CLOUDFLARE_R2_ACCESS_KEY]: process.env
      .CLOUDFLARE_R2_ACCESS_KEY as string,
    [CredentialType.CLOUDFLARE_R2_SECRET_KEY]: process.env
      .CLOUDFLARE_R2_SECRET_KEY as string,
    [CredentialType.CLOUDFLARE_R2_ACCOUNT_ID]: process.env
      .CLOUDFLARE_R2_ACCOUNT_ID as string,
  },
}).action();
```

## Operation Details

### `getUploadUrl`

<Tabs values={[
  { label: 'Input Schema', value: 'input' },
  { label: 'Output Schema', value: 'output' }
]} defaultValue="input">
  <TabItem value="input">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'getUploadUrl'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Generate presigned upload URL</dd>

<dt>
  <code>bucketName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the R2 bucket</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Original filename for the upload</dd>

<dt>
  <code>accountId</code> <em>string</em>{' '}
</dt>
<dd>Cloudflare Account ID - can be provided via credentials</dd>

<dt>
  <code>region</code> <em>string</em>{' '}
</dt>
<dd>AWS region for R2 storage (defaults to auto)</dd>

<dt>
  <code>expirationMinutes</code> <em>number</em>{' '}
</dt>
<dd>URL expiration time in minutes</dd>

<dt>
  <code>contentType</code> <em>string</em>{' '}
</dt>
<dd>Content type for uploads</dd>

<dt>
  <code>userId</code> <em>string</em>{' '}
</dt>
<dd>User ID for secure file isolation</dd>

  <dt><code>credentials</code> <em>Record&lt;CredentialType,string&gt;</em> </dt>
  <dd>Object mapping credential types to values (injected at runtime)</dd>
</dl>

</div>

  </TabItem>
  <TabItem value="output">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'getUploadUrl'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Generate presigned upload URL</dd>

<dt>
  <code>success</code> <em>boolean</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Whether the operation was successful</dd>

<dt>
  <code>uploadUrl</code> <em>string</em>{' '}
</dt>
<dd>Presigned upload URL</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
</dt>
<dd>Secure filename generated for the upload</dd>

<dt>
  <code>contentType</code> <em>string</em>{' '}
</dt>
<dd>Content type of the file</dd>

  <dt><code>error</code> <em>string</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Error message if operation failed</dd>
</dl>

</div>

  </TabItem>
</Tabs>

### `getFile`

<Tabs values={[
  { label: 'Input Schema', value: 'input' },
  { label: 'Output Schema', value: 'output' }
]} defaultValue="input">
  <TabItem value="input">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'getFile'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Generate presigned download URL</dd>

<dt>
  <code>bucketName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the R2 bucket</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the file to retrieve</dd>

<dt>
  <code>accountId</code> <em>string</em>{' '}
</dt>
<dd>Cloudflare Account ID - can be provided via credentials</dd>

<dt>
  <code>region</code> <em>string</em>{' '}
</dt>
<dd>AWS region for R2 storage (defaults to auto)</dd>

<dt>
  <code>expirationMinutes</code> <em>number</em>{' '}
</dt>
<dd>URL expiration time in minutes</dd>

<dt>
  <code>userId</code> <em>string</em>{' '}
</dt>
<dd>User ID for secure file isolation</dd>

  <dt><code>credentials</code> <em>Record&lt;CredentialType,string&gt;</em> </dt>
  <dd>Object mapping credential types to values (injected at runtime)</dd>
</dl>

</div>

  </TabItem>
  <TabItem value="output">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'getFile'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Generate presigned download URL</dd>

<dt>
  <code>success</code> <em>boolean</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Whether the operation was successful</dd>

<dt>
  <code>downloadUrl</code> <em>string</em>{' '}
</dt>
<dd>Presigned download URL</dd>

<dt>
  <code>fileUrl</code> <em>string</em>{' '}
</dt>
<dd>Direct file access URL</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
</dt>
<dd>Name of the file</dd>

<dt>
  <code>fileSize</code> <em>number</em>{' '}
</dt>
<dd>File size in bytes</dd>

<dt>
  <code>contentType</code> <em>string</em>{' '}
</dt>
<dd>Content type of the file</dd>

<dt>
  <code>lastModified</code> <em>string</em>{' '}
</dt>
<dd>Last modified timestamp in ISO format</dd>

  <dt><code>error</code> <em>string</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Error message if operation failed</dd>
</dl>

</div>

  </TabItem>
</Tabs>

### `deleteFile`

<Tabs values={[
  { label: 'Input Schema', value: 'input' },
  { label: 'Output Schema', value: 'output' }
]} defaultValue="input">
  <TabItem value="input">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'deleteFile'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Delete file from bucket</dd>

<dt>
  <code>bucketName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the R2 bucket</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the file to delete</dd>

<dt>
  <code>accountId</code> <em>string</em>{' '}
</dt>
<dd>Cloudflare Account ID - can be provided via credentials</dd>

<dt>
  <code>region</code> <em>string</em>{' '}
</dt>
<dd>AWS region for R2 storage (defaults to auto)</dd>

  <dt><code>credentials</code> <em>Record&lt;CredentialType,string&gt;</em> </dt>
  <dd>Object mapping credential types to values (injected at runtime)</dd>
</dl>

</div>

  </TabItem>
  <TabItem value="output">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'deleteFile'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Delete file from bucket</dd>

<dt>
  <code>success</code> <em>boolean</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Whether the operation was successful</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
</dt>
<dd>Name of the deleted file</dd>

<dt>
  <code>deleted</code> <em>boolean</em>{' '}
</dt>
<dd>Whether the file was successfully deleted</dd>

  <dt><code>error</code> <em>string</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Error message if operation failed</dd>
</dl>

</div>

  </TabItem>
</Tabs>

### `updateFile`

<Tabs values={[
  { label: 'Input Schema', value: 'input' },
  { label: 'Output Schema', value: 'output' }
]} defaultValue="input">
  <TabItem value="input">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'updateFile'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Update/replace file content</dd>

<dt>
  <code>bucketName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the R2 bucket</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the file to update</dd>

<dt>
  <code>accountId</code> <em>string</em>{' '}
</dt>
<dd>Cloudflare Account ID - can be provided via credentials</dd>

<dt>
  <code>region</code> <em>string</em>{' '}
</dt>
<dd>AWS region for R2 storage (defaults to auto)</dd>

<dt>
  <code>contentType</code> <em>string</em>{' '}
</dt>
<dd>Content type for uploads</dd>

<dt>
  <code>fileContent</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Base64 encoded file content or raw text content</dd>

  <dt><code>credentials</code> <em>Record&lt;CredentialType,string&gt;</em> </dt>
  <dd>Object mapping credential types to values (injected at runtime)</dd>
</dl>

</div>

  </TabItem>
  <TabItem value="output">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'updateFile'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Update/replace file content</dd>

<dt>
  <code>success</code> <em>boolean</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Whether the operation was successful</dd>

<dt>
  <code>fileName</code> <em>string</em>{' '}
</dt>
<dd>Name of the updated file</dd>

<dt>
  <code>updated</code> <em>boolean</em>{' '}
</dt>
<dd>Whether the file was successfully updated</dd>

<dt>
  <code>contentType</code> <em>string</em>{' '}
</dt>
<dd>Content type of the updated file</dd>

  <dt><code>error</code> <em>string</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Error message if operation failed</dd>
</dl>

</div>

  </TabItem>
</Tabs>

### `getMultipleUploadUrls`

<Tabs values={[
  { label: 'Input Schema', value: 'input' },
  { label: 'Output Schema', value: 'output' }
]} defaultValue="input">
  <TabItem value="input">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'getMultipleUploadUrls'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Generate multiple presigned upload URLs for PDF + page images</dd>

<dt>
  <code>bucketName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Name of the R2 bucket</dd>

<dt>
  <code>pdfFileName</code> <em>string</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Original filename for the PDF</dd>

<dt>
  <code>pageCount</code> <em>number</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Number of pages to generate upload URLs for</dd>

<dt>
  <code>accountId</code> <em>string</em>{' '}
</dt>
<dd>Cloudflare Account ID - can be provided via credentials</dd>

<dt>
  <code>region</code> <em>string</em>{' '}
</dt>
<dd>AWS region for R2 storage (defaults to auto)</dd>

<dt>
  <code>expirationMinutes</code> <em>number</em>{' '}
</dt>
<dd>URL expiration time in minutes</dd>

<dt>
  <code>userId</code> <em>string</em>{' '}
</dt>
<dd>User ID for secure file isolation</dd>

  <dt><code>credentials</code> <em>Record&lt;CredentialType,string&gt;</em> </dt>
  <dd>Object mapping credential types to values (injected at runtime)</dd>
</dl>

</div>

  </TabItem>
  <TabItem value="output">

<div className="schema-card">
<dl>
  <dt><code>operation</code> <em>'getMultipleUploadUrls'</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Generate multiple presigned upload URLs for PDF + page images</dd>

<dt>
  <code>success</code> <em>boolean</em>{' '}
  <span style={{ color: '#d32f2f', fontWeight: 600 }}>required</span>
</dt>
<dd>Whether the operation was successful</dd>

<dt>
  <code>pdfUploadUrl</code> <em>string</em>{' '}
</dt>
<dd>Presigned upload URL for PDF</dd>

<dt>
  <code>pdfFileName</code> <em>string</em>{' '}
</dt>
<dd>Secure filename for PDF</dd>

<dt>
  <code>pageUploadUrls</code> <em>object[]</em>{' '}
</dt>
<dd>Array of upload URLs for page images</dd>

  <dt><code>error</code> <em>string</em> <span style={{color:'#d32f2f',fontWeight:600}}>required</span></dt>
  <dd>Error message if operation failed</dd>
</dl>

</div>

  </TabItem>
</Tabs>
